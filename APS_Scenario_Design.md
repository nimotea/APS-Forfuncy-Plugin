# APS 插件使用场景与架构设计

本文档用于讨论 **APS 排程插件** 的实际应用场景及系统架构。

## 核心设计理念：高内聚、低耦合
为了保证排产逻辑的灵活性，我们将排产过程拆分为两个独立的核心环节：
1.  **工单排序 (Sequencing)**：解决“谁先做”的问题。根据交期、时长、优先级等规则生成最优加工序列。
2.  **资源分配 (Assignment)**：解决“在哪里做、几点做”的问题（规划中）。将排序后的工单分配到具体的机台或人员。

---

## 1. 场景一：离散制造业订单自动排产 (EDD 规则)

### 场景描述
一家五金加工厂每天收到大量零散订单。排产员需要根据交货日期的紧迫程度，快速生成一份当天的生产作业计划。

### Demo 实现思路
1. **数据准备**：在活字格中建立《待排产订单表》，包含：订单号、产品、加工时长、交货日期等。
2. **交互流程**：点击“一键排产”按钮，触发服务端命令。
3. **插件逻辑**：调用 **APS 工单排序** 插件，规则选择 `EDD`。
4. **结果展示**：插件返回按交期排序后的列表，页面刷新展示。

---

## 2. 场景二：高价值订单加急插单 (WSPT 规则)

### 场景描述
当工厂收到紧急且高价值的订单时，需要平衡“加工时长”和“客户重要程度（优先级）”，以确保利润最大化。

### Demo 实现思路
- **核心逻辑**：使用 `WSPT (加权最短加工时间优先)`。
- **配置方式**：设置优先级（1-10），插件自动计算 `优先级 / 加工时长`。
- **效果**：加工时间短且优先级高的订单会排在最前面，提升交付效率。

---

## 3. 场景三：临界延期风险监控 (CR 规则)

### 场景描述
在生产中后期，需要动态评估哪些订单面临延期风险，并重新调整顺序。

### Demo 实现思路
- **核心逻辑**：使用 `CR (临界比例规则)`。
- **计算方式**：`CR = (交期 - 当前) / 剩余工时`。
- **效果**：CR 值越小表示越紧急，插件会自动将这些面临超期风险的订单置顶。

---

## 4. 未来扩展：资源分配命令 (Assignment)

### 场景描述
当用户完成工单排序后，可以调用此命令将工单分配到多个并行机台上，并自动计算每个任务的计划开始和结束时间。

### 实现逻辑 (待开发)
- **输入**：已排序的工单列表 + 可用机台列表。
- **算法**：最早可用时间 (EFT) 贪心分配。
- **输出**：带有 `分配机台`、`计划开始时间`、`计划结束时间` 的结果集。

---

## 5. 演示 Demo 设计方案：离散制造排产工作台

为了展示重构后的 **APS 工单排序** 插件，我们设计一个名为“离散制造排产工作台”的 Demo。

### 5.1 页面构成
1.  **待排产列表（表格）**：展示从数据库加载的原始订单数据。
2.  **配置区**：
    -   下拉框：选择排序规则（EDD/SPT/WSPT/CR）。
    -   按钮：【执行智能排序】。
3.  **排序后结果（表格）**：展示插件处理后的数据。

### 5.2 核心逻辑流程
1.  **数据加载**：从数据库读取 `Status='待排产'` 的记录。
2.  **插件调用**：
    -   **输入**：将表格数据传给插件 `WorkOrders` 参数。
    -   **规则**：绑定下拉框选择的值。
    -   **输出**：存入变量 `SortedResult`。
3.  **展示**：页面表格绑定 `SortedResult` 变量显示结果。

### 5.3 演示数据示例 (JSON)
```json
[
  {"工单号":"WO001", "加工时长":4.5, "交货日期":"2026-02-20", "订单优先级":3, "到达时间":"2026-02-13"},
  {"工单号":"WO002", "加工时长":2.0, "交货日期":"2026-02-15", "订单优先级":5, "到达时间":"2026-02-13"},
  {"工单号":"WO003", "加工时长":8.0, "交货日期":"2026-02-18", "订单优先级":1, "到达时间":"2026-02-13"}
]
```

---

## 6. 讨论区
- [x] 是否需要支持“多资源/多机台”排产？ -> **已决定采用“排序+分配”解耦架构，当前已实现排序命令。**
- [ ] 是否需要增加“机台能力差异”约束？
- [ ] 是否需要 Demo 包含甘特图展示？
